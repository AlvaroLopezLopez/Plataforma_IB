"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9194],{39194:function(e,r,t){t.d(r,{Kk:function(){return em},hr:function(){return y},NT:function(){return rE},nf:function(){return J},oW:function(){return rl},u1:function(){return rI},J0:function(){return rP},Lv:function(){return rR},K_:function(){return ru},Kd:function(){return ev},k$:function(){return rB},yA:function(){return eS}});var s=t(52322),o=t(78502),n=t(59888),i=t(81836),a=t(71946),l=t(76385),c=t(39097),d=t.n(c),u=t(57542),m=t(99792),p=t(94482),x=t(84311);let h=e=>{let{caseStudy:r,href:t,onClick:a,accessLevel:l,isAccessible:c,progressPercentage:d,sx:p}=e,h=(0,o.Z)();return(0,s.jsxs)(n.Z,{position:"relative",height:"100%",sx:{transition:"transform 300ms","&:hover":{transform:"translateY(-5px)"}},children:[(0,s.jsx)(g,{caseStudy:r,href:t,onClick:a,progressPercentage:d,sx:p}),c&&r.status===m.kZP.PublishedRestricted?(0,s.jsx)(i.Z,{sx:{top:h.spacing(-1),right:h.spacing(2),position:"absolute"},children:(0,s.jsx)(x.Xn,{})}):(0,s.jsx)(u.dz,{accessLevel:l,isAccessible:c,isAdminOnly:r.status===m.kZP.AdminOnly,containerStyles:{top:h.spacing(-1),right:h.spacing(2),position:"absolute"}})]})},g=e=>{let{onClick:r,caseStudy:{name:t,description_short:n,difficulty:c,duration:h,status:g,reference:y},href:b,progressPercentage:j,sx:S}=e,f=(0,o.Z)();return(0,s.jsx)(i.Z,{sx:{height:"100%",p:2.5,borderRadius:f.shape.borderRadius,backgroundColor:f.palette.common.white,border:"1px solid ".concat(f.colors.common.grey[200]),...S},children:(0,s.jsxs)(i.Z,{component:b?d():a.Z,href:b,onClick:()=>{null==r||r()},sx:{textDecoration:"none",height:"100%"},children:[(0,s.jsxs)(i.Z,{direction:c?"row":"row-reverse",justifyContent:"space-between",alignItems:"center",children:[c&&(0,s.jsx)(x.Sv,{value:c}),h&&(0,s.jsxs)(i.Z,{direction:"row",alignItems:"center",spacing:.5,children:[(0,s.jsx)(p.T3,{sx:{width:"16px",height:"16px"},fill:f.colors.common.primary[200]}),(0,s.jsx)(l.Z,{variant:"p-sm-rg",color:f.colors.common.primary[400],children:"".concat(h," mins")})]})]}),(0,s.jsxs)(l.Z,{mt:2,variant:"p-md-semibold",overflow:"hidden",textOverflow:"ellipsis",sx:{WebkitLineClamp:2,WebkitBoxOrient:"vertical",display:"-webkit-box"},color:f.colors.common.primary[600],children:[t,g===m.kZP.AdminOnly?(0,s.jsxs)("span",{style:{color:"red"},children:[" (",y,")"]}):""]}),(0,s.jsx)(l.Z,{mt:2,variant:"p-sm-rg",overflow:"hidden",textOverflow:"ellipsis",sx:{WebkitLineClamp:7,WebkitBoxOrient:"vertical",display:"-webkit-box",lineHeight:"1.25rem",color:f.colors.common.primary[500]},children:n}),j?(0,s.jsx)(u.gk,{percentage:j,boxProps:{height:"auto",pt:2.5,mt:"auto"}}):null]})})},y=e=>{let{caseStudy:{name:r,description_short:t,difficulty:n,duration:a},onClick:c}=e,d=(0,o.Z)();return(0,s.jsxs)(i.Z,{sx:{height:"100%",borderRadius:4,p:d.spacing(2.5,2),border:"1px solid ".concat(d.palette.grey[200])},spacing:2,onClick:c,children:[(0,s.jsxs)(i.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[n&&(0,s.jsx)(x.Sv,{value:n}),(0,s.jsxs)(i.Z,{direction:"row",spacing:.5,alignItems:"center",children:[(0,s.jsx)(p.T3,{sx:{width:16,height:16},fill:d.colors.common.primary[200]}),(0,s.jsxs)(l.Z,{variant:"p-sm-rg",color:d.colors.common.primary[400],children:[a," minutes"]})]})]}),(0,s.jsxs)(i.Z,{spacing:1,children:[(0,s.jsx)(l.Z,{variant:"p-md-semibold",color:d.colors.common.primary[600],children:r}),(0,s.jsx)(l.Z,{variant:"p-sm-rg",color:d.colors.common.primary[600],children:t})]})]})};var b=t(2784),j=t(82066),S=t(38991),f=t(52519),v=t(48699),Z=t(16962),w=t(28573),C=t(78315),k=t(97487),I=t(77458),P=t(35917),R=t(25619),A=t(12667),T=t(20614),M=t(68696),E=t(67614),_=t(9763);let G="open_study",q="exam",W={[G]:{label:"Open Study Mode",tooltipText:"Feedback as you go! Markschemes, video solutions, and AI Feedback on every question."},[q]:{label:"Examination Mode",tooltipText:"Test yourself in exam-like conditions. Receive feedback and see results upon completion!"}},F=b.memo(function(e){let{mode:r,setMode:t,modeEnabled:n}=e,i=(0,o.Z)(),{user:a}=(0,E.v$)();return(0,s.jsx)(A.Z,{variant:"scrollable",scrollButtons:"auto",value:r,onChange:(e,r)=>{t(r)},sx:{width:"fit-content","& .MuiTabs-indicator":{display:"none"},".MuiTabs-flexContainer":{backgroundColor:i.palette.common.white,borderRadius:6*i.shape.borderRadius}},children:Object.entries(W).map(e=>{let r=e[0],{label:t,tooltipText:o}=e[1],l=(null==a?void 0:a.type)===_.FW.User&&(r===q&&n===m.Fo1.OpenStudy||r===G&&n===m.Fo1.Exam);return(0,s.jsx)(B,{tooltipText:o,label:t,value:r,disabled:l,sx:{py:1.25,px:3,lineHeight:1,textTransform:"none",color:i.colors.common.primary[600],fontWeight:600,"&.Mui-selected":{backgroundColor:i.colors.common.primary[600],borderRadius:6*i.shape.borderRadius,color:i.palette.common.white}}},r)})})}),B=e=>{let{tooltipText:r,...t}=e,n=(0,o.Z)();return(0,s.jsx)(T.Z,{title:r,enterDelay:1e3,enterNextDelay:1e3,children:(0,s.jsx)(M.Z,{...t,label:(0,s.jsxs)(i.Z,{direction:"row",alignItems:"center",gap:1,children:[e.label,e.disabled&&(0,s.jsx)(u.rK,{sx:{backgroundColor:n.colors.common.brand[600]},typographyProps:{textTransform:"none"}})]})})})};var O=t(14313),N=t(60218),D=t(15794),U=t(1676),z=t(44258);let L=e=>{let{label:r,extracts:t,jumpTo:n,onJumpTo:a,onOpenNewTab:c}=e,d=(0,o.Z)(),u=!!c&&t.length>0;return(0,s.jsxs)(N.ZP,{container:!0,sx:e=>({padding:e.spacing(3,4),position:"sticky",alignItems:"center"}),children:[(0,s.jsx)(N.ZP,{item:!0,xs:8,children:(0,s.jsxs)(i.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,s.jsxs)(l.Z,{variant:"p-sm-rg",color:d.colors.common.primary[400],children:[r,":"]}),(0,s.jsx)(D.Z,{sx:{backgroundColor:d.colors.common.grey[100],borderRadius:.5*d.shape.borderRadius,width:"100%",".MuiInputBase-input":{padding:d.spacing(1,2)},fieldset:{border:"none"}},value:n,onChange:e=>a(e.target.value),MenuProps:{sx:{".MuiPaper-root":{backgroundColor:d.colors.common.grey[100],borderRadius:2},".MuiMenuItem-root":{fontSize:"0.9rem",color:d.palette.common.black},".Mui-selected, .MuiMenuItem-root:hover":{backgroundColor:d.colors.common.grey[200]}}},children:t.map(e=>{let{id:r,label:t}=e;return(0,s.jsx)(U.Z,{value:r,children:t},r)})})]})}),u&&(0,s.jsx)(N.ZP,{item:!0,xs:4,sx:{display:"flex",justifyContent:"end"},children:(0,s.jsx)(z.Z,{variant:"solid",color:"secondary",onClick:c,size:"large",children:(0,s.jsx)(p.O5,{fill:d.colors.common.primary[500],sx:{width:24,height:24}})})})]})};var Q=t(57909),K=t(15159);let Y=e=>{let{name:r,encryptedContent:t,images:o,audioClips:n=[],...i}=e,a=(0,K.kT)({useEncryption:i.useEncryption,requestId:i.useEncryption?i.ephemeralId:"",encryptedContent:t});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Z,{variant:"p-md-semibold",align:"center",children:r}),(0,s.jsx)(Q.Ns,{value:null!=a?a:"",variant:"ib",images:o,fontSize:"1.125rem",audioClips:n})]})};var V=t(81014);let H=(0,b.memo)(function(e){var r,t,n;let{caseStudy:a,caseStudyExtracts:l,onOpenNewTab:c,inContainer:d=!1,...u}=e,m=(0,o.Z)(),[p,x]=(0,b.useState)(null!==(t=null==l?void 0:null===(r=l[0])||void 0===r?void 0:r.id)&&void 0!==t?t:""),h=(0,b.useRef)(null),g=(0,b.useRef)({}),y=d||!!c;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L,{extracts:l,label:null!==(n=a.extract_label)&&void 0!==n?n:"Extracts",jumpTo:p,onJumpTo:e=>{x(e);let r=g.current[e];if(r){if(y&&h.current){let e=h.current.offsetTop,t=r.offsetTop;h.current.scrollTo({top:t-e,behavior:"smooth"});return}window.scrollTo({top:r.offsetTop-80,behavior:"smooth"})}},onOpenNewTab:c}),(0,s.jsx)(i.Z,{ref:h,p:m.spacing(3,4),rowGap:10,paddingBottom:8,sx:{scrollPaddingTop:"64px",height:y?"calc(100% - 84px)":"auto",overflowY:"auto",backgroundColor:m.palette.common.white,borderTop:"1px solid ".concat(m.colors.common.grey[200])},children:l.map(e=>{let{id:r,name:t,content:o,images:n,audio_clips:a}=e;return(0,s.jsx)(i.Z,{rowGap:2,ref:e=>{e&&(g.current[r]=e)},children:(0,s.jsx)(Y,{name:t,id:r,encryptedContent:o,images:n,audioClips:a,useEncryption:u.useEncryption,ephemeralId:u.useEncryption?u.ephemeralId:""})},r)})})]})}),J=e=>(0,s.jsx)(O.Z,{theme:V.rS,children:(0,s.jsx)(H,{...e})});var X=t(87622),$=t.n(X),ee=t(88896),er=t(62301),et=t(88459),es=t(59568),eo=t(50131),en=t(24502),ei=t(15656),ea=t(54073),el=t.n(ea),ec=t(15631),ed=t(28738),eu=t(17625);let em=e=>{let{children:r,startIcon:t,endIcon:o,onClick:n,sx:c}=e;return(0,s.jsxs)(i.Z,{component:a.Z,fullWidth:!0,direction:"row",spacing:.5,onClick:n,sx:{p:1,px:1.5,borderRadius:2,cursor:"pointer",...c},justifyContent:"center",alignItems:"center",children:[t,(0,s.jsx)(l.Z,{variant:"p-sm-md",textTransform:"none",noWrap:!0,children:r}),o]})},ep=e=>{let{children:r,startIcon:t,onClick:n,expanded:i,expandUpwards:l=!1,sx:c}=e,d=(0,o.Z)();return(0,s.jsx)(a.Z,{onClick:n,startIcon:t,sx:{width:"100%",backgroundColor:i?d.colors.common.brand[200]:d.colors.common.brand[50],fontWeight:400,borderRadius:2,color:d.colors.common.primary[500],":hover":{backgroundColor:d.colors.common.brand[200]},":after":{visibility:i?"visible":"hidden",opacity:i?1:0,transition:"visibility 0s, opacity 0.25s linear",content:'""',position:"absolute",...!l&&{top:"100%",borderTop:"8px solid ".concat(d.colors.common.brand[200])},...l&&{bottom:"100%",borderBottom:"8px solid ".concat(d.colors.common.brand[200])},borderLeft:"8px solid transparent",borderRight:"8px solid transparent"},...c},children:r})};var ex=t(92504);let eh=(e,r,t)=>{let{api:s}=(0,R.Qy)(),o=(0,j.useQueryClient)();return(0,j.useMutation)({mutationFn:t=>s.assessment.mutate({mutation:ex.RP,variables:{input:{where:{userCaseStudyId_caseStudyPartId:{caseStudyPartId:e,userCaseStudyId:r}},data:t}}}).then(e=>{var r;return null===(r=e.data)||void 0===r?void 0:r.upsertUserCaseStudyPartAnswer}),onSuccess:s=>{null==t||t(),o.setQueryData(R.iP.userCaseStudy(null!=r?r:""),r=>{var t,o,n;if(!r)return null;let i=[];return i=(null===(t=r.partAnswers)||void 0===t?void 0:t.map(e=>{let{caseStudyPartId:r}=e;return r}).includes(e))?null===(o=r.partAnswers)||void 0===o?void 0:o.map(r=>r.caseStudyPartId===e?{...r,answer:null==s?void 0:s.answer}:r):[...null!==(n=null==r?void 0:r.partAnswers)&&void 0!==n?n:[],{caseStudyPartId:e,markingStatus:P.L4.NotStarted,answer:null==s?void 0:s.answer}],{...r,partAnswers:i}})}})},eg=(0,b.createContext)(null),ey=()=>{let e=(0,b.useContext)(eg);if(!e)throw Error("CaseStudyPageContext value cannot be null");return e};var eb=t(17286),ej=t(15883);let eS=e=>{switch(e){case m.yWx.MockExamPaper:return m.qx1.MockExamPaper;case m.yWx.PredictionExamPaper:return m.qx1.PredictionExamPaper;case m.yWx.Assessment:return m.qx1.Assessment;case m.yWx.CaseStudyGroup:return m.qx1.CaseStudyGroup;case m.yWx.BootCampSection:return m.qx1.BootCampSection;default:throw Error("CaseStudyContext: ".concat(e," not supported for video solutions"))}},ef=e=>{switch(e){case I.Ar.CaseStudyGroup:return m.qx1.CaseStudyGroup;case I.Ar.MockExamPaper:return m.qx1.MockExamPaper;case I.Ar.PredictionExamPaper:return m.qx1.PredictionExamPaper;case I.Ar.BootCampSection:return m.qx1.BootCampSection;case I.Ar.QuestionbankSubtopic:case I.Ar.QuestionbankTopic:case I.Ar.Quiz:case I.Ar.RevisionLadder:default:throw Error("accessContextType: ".concat(e," not supported for video solutions"))}},ev=e=>{let{open:r,onClose:t,videoSolutions:o,partId:a,videoSolutionContext:c,videoSolutionContextId:d,subjectId:p}=e,[x,h]=(0,b.useState)(o[0]),g=(0,b.useCallback)(e=>{h(e)},[]);(0,b.useEffect)(()=>{r||h(o[0])},[r,o]);let y=o.length,j=(0,s.jsxs)(i.Z,{sx:{backgroundColor:"white",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:{xs:"100%",md:"90%",xl:"60%"},borderRadius:2},children:[y>1&&(0,s.jsx)(i.Z,{direction:"row",spacing:1,p:{xs:1,md:3},pb:"0 !important",sx:{"&>.MuiBox-root>.MuiBox-root":{backgroundColor:ej.O.purple.light,border:"none"},"&>.MuiBox-root>.MuiBox-root p":{color:ej.O.purple.dark,fontWeight:600},"&>.MuiBox-root.selected>.MuiBox-root":{backgroundColor:ej.O.purple.dark},"&>.MuiBox-root.selected>.MuiBox-root p":{color:ej.O.purple.light}},children:o.map(e=>(0,s.jsx)(u.xd,{selected:e.name==(null==x?void 0:x.name),label:e.name||"video(".concat(e.index,")"),onClick:()=>g(e)},e.name))}),(0,s.jsx)(n.Z,{sx:{justifyContent:"center",alignItems:"center",display:x?"block":"flex",p:{xs:1,md:3}},children:x&&x.id?(0,s.jsx)(u.pz,{title:x.name||"Video",videoSolutionId:x.id,entityId:a,entityType:m.lWU.CaseStudyPart,contextEntity:c,contextEntityId:d,subjectId:p}):(0,s.jsx)(n.Z,{sx:{position:"relative",pb:"56.25%",height:"100%",width:"100%"},children:(0,s.jsx)(l.Z,{variant:"p-sm-rg",sx:{position:"absolute",top:"40%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center",width:"80%"},children:"This video is not available. Please select another one to view."})})})]});return(0,s.jsx)(eb.Z,{open:r,onClose:t,children:j})};var eZ=t(9736);let ew=(0,b.memo)(function(e){var r,t;let{userCaseStudy:n,caseStudyPart:a,partAnswer:c,updateCaseStudyPartProgress:d,requestId:x}=e,h=(0,o.Z)(),{user:g}=(0,E.v$)(),{subjectLabels:y,showRichTextToolbar:j,accessContextType:S,contextEntityId:f,subjectId:v}=ey(),[Z]=(0,eZ.CJ)("CASE_STUDY_VIDEO_SOLUTIONS"),w=(0,b.useRef)(n.completedAt),{name:C,content:k,mark_scheme:I,images:R,maximum_mark:A,video_solutions:T,id:M,audio_clips:G}=a,{content:q,markScheme:W}=(0,K.Ei)({useEncryption:!0,requestId:x,encryptedContent:k,encryptedMarkScheme:I}),[F,B]=(0,b.useState)(!1),[O,N]=(0,b.useState)(null!==(r=null==c?void 0:c.answer)&&void 0!==r?r:"<p></p>"),[D,U]=(0,b.useState)(0),[z,L]=(0,b.useState)(!1),[Y,V]=(0,b.useState)(null),{mutate:H,isLoading:J}=eh(a.id,n.id,()=>L(!1)),X=y.mark_scheme_label||"Mark Scheme";(0,b.useEffect)(()=>{if(n.completedAt!==w.current){if(!n.completedAt){var e;N(null!==(e=null==c?void 0:c.answer)&&void 0!==e?e:"<p></p>"),U(e=>e+1)}w.current=n.completedAt}},[null==c?void 0:c.answer,n.completedAt]);let $=(0,b.useCallback)(e=>{H({answer:e})},[H]),ee=(0,b.useMemo)(()=>el()($,3e3,{maxWait:15e3,trailing:!0}),[$]),er=!!n.completedAt,et=z&&!J;(0,b.useEffect)(()=>{let e=et||J;d(a.id,e)},[a.id,J,et,d]);let es=(0,b.useCallback)(e=>{V(e)},[]),ei=(Z||(null==g?void 0:g.type)===_.FW.Admin)&&!!T&&!!T.length;return(0,s.jsxs)(i.Z,{sx:{p:2,pt:3},children:[(0,s.jsx)(Q.Ns,{variant:"ib",fontSize:"1.125rem",value:q,images:R,audioClips:G}),(0,s.jsxs)(i.Z,{p:2,mt:3,sx:{border:"1px solid ".concat(h.colors.common.grey[200]),borderRadius:.5*h.shape.borderRadius},children:[(0,s.jsxs)(i.Z,{direction:"row",justifyContent:"space-between",pb:1,children:[(0,s.jsx)(l.Z,{variant:"p-sm-rg",color:h.colors.common.primary[600],children:"Your Response:"}),(0,s.jsx)(i.Z,{direction:"row",spacing:.5,alignItems:"center",children:et?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Z,{variant:"p-xs-rg",color:h.colors.common.primary[400],children:"Changes made"}),(0,s.jsx)(eo.hL,{sx:{width:16,height:16}})]}):J?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Z,{variant:"p-xs-rg",color:h.colors.common.primary[400],children:"Saving..."}),(0,s.jsx)(ed.Z,{size:"16px",sx:{color:h.colors.common.primary[600]}})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Z,{variant:"p-xs-rg",color:h.colors.common.primary[400],children:"Saved"}),(0,s.jsx)(p.yQ,{sx:{width:16,height:16}})]})})]}),(0,s.jsx)(ec.H4,{content:O,editorKey:"".concat(a.id,"-").concat(D),updateContent:e=>{z||L(!0),N(e),ee(e)},editable:!er,hideMenuBar:!j,sx:{fontSize:"0.875rem",color:h.colors.common.primary[600],borderRadius:.5*h.shape.borderRadius}}),er&&(0,s.jsxs)(s.Fragment,{children:[(null==n?void 0:n.markingStatus)===P.L4.AutomarkingCompleted&&(0,s.jsxs)(i.Z,{sx:{mt:3,backgroundColor:h.colors.common.grey[100],p:2,borderRadius:.5*h.shape.borderRadius},spacing:1,children:[(0,s.jsxs)(i.Z,{justifyContent:"space-between",direction:"row",children:[(0,s.jsxs)(i.Z,{direction:"row",alignItems:"center",spacing:.5,children:[(0,s.jsx)(eo.JY,{sx:{width:16,height:16},fill:h.colors.common.primary[600]}),(0,s.jsx)(l.Z,{variant:"p-sm-rg",color:h.colors.common.primary[600],children:"Newton AI feedback"})]}),(0,s.jsxs)(l.Z,{variant:"p-xs-rg",color:h.colors.common.primary[400],children:[null!==(t=null==c?void 0:c.aiGenMarks)&&void 0!==t?t:0," / ",A," marks"]})]}),(0,s.jsx)(ec.H4,{content:(null==c?void 0:c.aiGenFeedback)?(0,en.n8)(c.aiGenFeedback):"No answer provided. To understand how to answer this question, see the mark scheme.",editorKey:"feedback",editable:!1,sx:{minHeight:0,borderRadius:.5*h.shape.borderRadius,color:h.colors.common.primary[600],backgroundColor:h.palette.common.white,fontSize:"0.875rem",".ProseMirror":{py:1.5}}})]}),(0,s.jsx)(ep,{startIcon:(0,s.jsx)(p.WG,{fill:h.colors.common.primary[500]}),onClick:()=>{B(!F),V(null)},expanded:F,sx:{mt:2},children:ei?"".concat(X," & Solution"):X}),(0,s.jsx)(eu.Z,{in:F,children:(0,s.jsxs)(i.Z,{mt:2,sx:{border:"1px solid ".concat(h.colors.common.brand[200]),borderRadius:.5*h.shape.borderRadius},children:[ei&&(0,s.jsxs)(i.Z,{borderBottom:"1px solid ".concat(h.colors.common.brand[200]),children:[(0,s.jsxs)(i.Z,{p:2,direction:"row",spacing:2,alignItems:"center",children:[(0,s.jsx)(l.Z,{variant:"p-sm-semibold",color:h.colors.common.primary[600],children:T.length>1?"Video Solutions":"Video Solution"}),(0,s.jsx)(i.Z,{direction:"row",spacing:1,children:T.map(e=>(0,s.jsx)(u.Kd,{selected:e.id===(null==Y?void 0:Y.id),label:e.name||C,onClick:()=>es(e)},e.name))})]}),Y&&(0,s.jsx)(i.Z,{p:h.spacing(0,2,1.5),children:(0,s.jsx)(u.pz,{title:Y.name||"Video",videoSolutionId:Y.id,entityId:M,entityType:m.lWU.CaseStudyPart,contextEntity:ef(S),contextEntityId:f,subjectId:v})})]}),(0,s.jsxs)(i.Z,{p:2,spacing:1,children:[(0,s.jsx)(l.Z,{variant:"p-sm-semibold",children:"Mark Scheme"}),(0,s.jsx)(Q.Ns,{variant:"ib",fontSize:"1rem",value:W,images:R,audioClips:G})]})]})})]})]})]})});var eC=t(67605),ek=t(78630),eI=t(84217);let eP="<p></p>",eR=(0,b.memo)(function(e){let{newtonExpanded:r,partId:t,isAuthenticated:n,showAccessDeniedModal:c,onSubmit:d,numUsesRemainingInfo:m,refetchNumUsesRemainingInfo:x,partDrawingImageUrl:h,maxMarks:g}=e,y=(0,o.Z)(),{contextEntityId:j,accessContextType:S,subjectLabels:f,subjectId:v}=ey(),[Z,w]=(0,b.useState)(eP),[C,k]=(0,b.useState)(""),[P,R]=(0,b.useState)(null),[A,M]=(0,b.useState)(!1),[E,_]=(0,b.useState)(!1),{numUsesRemaining:G,allocationType:q}=null!=m?m:{},W=(0,b.useCallback)(()=>{M(!1),_(!1)},[]),F=(0,b.useCallback)(e=>{!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Something went wrong, please try again later.";en.A9.error(e)}(e),W()},[W]),B=(0,b.useCallback)(e=>{k(e.feedback),R(e.grade),W(),null==x||x()},[W,x]),[O]=(0,ek.v)({onError:F,onSuccess:B}),N=(0,b.useCallback)(e=>{w(e)},[]);(0,b.useLayoutEffect)(()=>{M(Z===eP)},[Z]),(0,b.useEffect)(()=>{!1===r&&Z===eP&&""!==C&&(k(""),R(null))},[C,Z,r]);let D=f.ai_label?"Answer":"Check your answer with Newton";return(0,s.jsx)(eu.Z,{in:r,children:(0,s.jsxs)(i.Z,{p:2,mt:3,sx:{border:"1px solid ".concat(y.colors.common.grey[200]),borderRadius:.5*y.shape.borderRadius},children:[(0,s.jsx)(i.Z,{direction:"row",justifyContent:"space-between",pb:1,children:(0,s.jsx)(l.Z,{variant:"p-sm-rg",color:y.colors.common.primary[400],children:D})}),(0,s.jsx)(ec.H4,{content:Z,entityType:eI.GI.UserCaseStudyPartAnswer,entityId:t,editorKey:"answer",updateContent:N,editable:!E,hideMenuBar:!1,questionImageUrl:h,sx:{fontSize:"0.875rem",color:y.colors.common.primary[600],borderRadius:.5*y.shape.borderRadius}}),(0,s.jsxs)(i.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",mt:3,children:[q===I.aj.AllTime&&(0,s.jsx)(T.Z,{title:"Gold users have unlimited uses for this feature",children:(0,s.jsxs)(i.Z,{direction:"row",display:"inline-flex",alignItems:"center",gap:1,children:[(0,s.jsxs)(l.Z,{variant:"p-xs-rg",color:y.colors.common.primary[400],children:["number"==typeof G&&G<=0?"No":G," free uses remaining"]}),(0,s.jsx)(p.sz,{sx:{width:16,height:16},htmlColor:y.colors.common.primary[600]})]})}),(0,s.jsx)(a.Z,{variant:"solid",color:"primary",onClick:()=>{if(!n){c({isAccessible:!1,reason:ei.KG.RequiresFree});return}if("number"==typeof G&&G<=0){q===I.aj.AllTime?c({isAccessible:!1,reason:ei.KG.RequiresPaid}):en.A9.error("You have used up all your Newton AI feedback uses for the month. Please contact us for more information");return}d(),M(!0),_(!0),k(""),R(null),O({query:Z,subjectId:v,entityId:t,entityType:I.lD.CaseStudyPart,contextEntityId:j,contextType:S})},disabled:A,startIcon:(0,s.jsx)(eo.QM,{fill:A?y.colors.common.primary[200]:y.palette.common.white}),sx:{ml:q===I.aj.AllTime?0:"auto"},children:(0,s.jsx)(u.aN,{isLoading:E,size:16,sx:{color:y.colors.common.primary[600]},children:"Submit"})})]}),""!==C&&(0,s.jsxs)(i.Z,{sx:{mt:3,backgroundColor:y.colors.common.grey[100],p:2,borderRadius:.5*y.shape.borderRadius},spacing:1,children:[(0,s.jsxs)(i.Z,{justifyContent:"space-between",direction:"row",children:[(0,s.jsxs)(i.Z,{direction:"row",alignItems:"center",spacing:.5,children:[(0,s.jsx)(eo.JY,{sx:{width:16,height:16},fill:y.colors.common.primary[600]}),(0,s.jsx)(l.Z,{variant:"p-sm-rg",color:y.colors.common.primary[600],children:"Newton AI feedback"})]}),null!=P&&(0,s.jsxs)(l.Z,{variant:"p-xs-rg",color:y.colors.common.primary[400],children:[P," / ",g," marks"]})]}),(0,s.jsx)(ec.H4,{content:C,editorKey:"feedback-".concat(t),editable:!1,sx:{minHeight:0,borderRadius:.5*y.shape.borderRadius,color:y.colors.common.primary[600],backgroundColor:y.palette.common.white,fontSize:"0.875rem",".ProseMirror":{py:1.5}}})]})]})})}),eA=(0,b.memo)(function(e){let{caseStudyPart:r,isAuthenticated:t,onSubmit:n,showAccessDeniedModal:a,numUsesRemainingInfo:c,refetchNumUsesRemainingInfo:d,requestId:x}=e,h=(0,o.Z)(),{subjectLabels:g,contextEntityId:y,accessContextType:j,subjectId:S}=ey(),[f]=(0,eZ.CJ)("CASE_STUDY_VIDEO_SOLUTIONS"),{name:v,content:Z,mark_scheme:w,images:C,id:k,video_solutions:I,audio_clips:P,maximum_mark:R}=r,{content:A,markScheme:T}=(0,K.Ei)({useEncryption:!0,requestId:x,encryptedContent:Z,encryptedMarkScheme:w}),{user:M}=(0,E.v$)(),[G,q]=(0,b.useState)(!1),[W,F]=(0,b.useState)(!1),[B,O]=(0,b.useState)(null),D=(0,b.useCallback)(e=>{if(!t){a({isAccessible:!1,reason:ei.KG.RequiresFree});return}O(e)},[t,a]),U=g.ai_label||"Check with Newton",z=g.mark_scheme_label||"Mark Scheme",L=(f||(null==M?void 0:M.type)===_.FW.Admin)&&!!I&&!!I.length,Y=C.find(e=>e.entity_type===m.jor.CaseStudyPartDrawing);return(0,s.jsxs)(i.Z,{sx:{p:2,pt:3},children:[(0,s.jsx)(Q.Ns,{variant:"ib",fontSize:"1.125rem",value:A,images:C,audioClips:P}),(0,s.jsx)(eC.Z,{children:(0,s.jsx)(eR,{newtonExpanded:W,maxMarks:R,partId:k,isAuthenticated:t,onSubmit:n,showAccessDeniedModal:a,numUsesRemainingInfo:c,refetchNumUsesRemainingInfo:d,partDrawingImageUrl:null==Y?void 0:Y.url})}),(0,s.jsx)(i.Z,{mt:3,children:(0,s.jsxs)(N.ZP,{container:!0,spacing:1.5,flexDirection:{xs:"column-reverse",lg:"row"},children:[(0,s.jsx)(N.ZP,{item:!0,xs:12,lg:6,children:(0,s.jsx)(ep,{startIcon:(0,s.jsx)(p.WG,{fill:h.colors.common.primary[500]}),onClick:()=>{q(!G),O(null)},expanded:G,children:L?"".concat(z," & Solution"):z})}),(0,s.jsx)(N.ZP,{item:!0,xs:12,lg:6,children:(0,s.jsx)(ep,{startIcon:(0,s.jsx)(eo.QM,{fill:h.colors.common.primary[500]}),onClick:()=>F(!W),expanded:W,expandUpwards:!0,children:U})})]})}),(0,s.jsx)(eu.Z,{in:G,children:(0,s.jsxs)(i.Z,{mt:2,sx:{border:"1px solid ".concat(h.colors.common.brand[200]),borderRadius:.5*h.shape.borderRadius},children:[L&&(0,s.jsxs)(i.Z,{borderBottom:"1px solid ".concat(h.colors.common.brand[200]),children:[(0,s.jsxs)(i.Z,{p:2,direction:"row",spacing:2,alignItems:"center",children:[(0,s.jsx)(l.Z,{variant:"p-sm-semibold",color:h.colors.common.primary[600],children:I.length>1?"Video Solutions":"Video Solution"}),(0,s.jsx)(i.Z,{direction:"row",spacing:1,children:I.map(e=>(0,s.jsx)(u.Kd,{selected:e.id===(null==B?void 0:B.id),label:e.name||v,onClick:()=>D(e)},e.name))})]}),B&&(0,s.jsx)(i.Z,{p:h.spacing(0,2,1.5),children:(0,s.jsx)(u.pz,{title:B.name||"Video",videoSolutionId:B.id,entityId:k,entityType:m.lWU.CaseStudyPart,contextEntity:ef(j),contextEntityId:y,subjectId:S})})]}),(0,s.jsxs)(i.Z,{p:2,spacing:1,children:[(0,s.jsx)(l.Z,{variant:"p-sm-semibold",children:z}),(0,s.jsx)(Q.Ns,{variant:"ib",fontSize:"1rem",value:T,images:C,audioClips:P})]})]})})]})}),eT=e=>{let{completionStatus:r,disabled:t,onClick:o}=e;return(0,s.jsx)(T.Z,{title:"Mark as complete",children:(0,s.jsx)(z.Z,{size:"large",sx:{padding:0,height:"auto",":hover":{background:"none"}},onClick:o,disabled:t,children:r===_.mT.Incomplete?(0,s.jsx)(p.rE,{}):(0,s.jsx)(p.kv,{})})})};var eM=t(53058);let eE=e=>{var r,t;let{caseStudyId:o,caseStudyPartId:n,caseStudyPartName:i}=e,{user:a}=(0,E.v$)(),{subjectId:l,subjectCaseStudyName:c}=ey(),{caseStudyFeedbackFormUrl:d}=(0,eM.JR)();return(0,s.jsx)("iframe",{title:"feedback_form",src:"".concat(d,"#").concat(new URLSearchParams({case_study_id:o,case_study_part_id:n,case_study_full_name:"".concat(c," - ").concat(i),subject_id:l,user_id:null!==(r=null==a?void 0:a.id)&&void 0!==r?r:"not logged in",user_type:a?null!==(t=null==a?void 0:a.kind)&&void 0!==t?t:_.VF.Student:"not logged in"}).toString()),width:"100%",height:"100%",frameBorder:0,marginHeight:0,marginWidth:0})},e_={isAccessible:!1,reason:ei.KG.RequiresFree},eG=(0,b.memo)(function(e){let{caseStudyId:r,caseStudyPart:t,completionStatus:a,mode:c,userCaseStudy:d,partAnswer:m,setPartsSavedState:p,updateCaseStudyPart:h,numUsesRemainingInfo:g,refetchNumUsesRemainingInfo:y,requestId:S}=e,{api:f}=(0,R.Qy)(),v=(0,o.Z)(),Z=!!d,{difficulty:w,name:C,id:k,content:I,mark_scheme:P,images:A,maximum_mark:M,video_solutions:E,audio_clips:q}=t,[W,F]=(0,b.useState)(!1),[B,O]=(0,b.useState)({isAccessible:!1,reason:ei.KG.RequiresFree}),[D,U]=(0,b.useState)(!1),{mutate:L,isLoading:Q}=(0,j.useMutation)({mutationFn:e=>f.caseStudyPartState.putCaseStudyPartState({case_study_part_id:k,case_study_id:r,status:e}),onError:()=>{h(k,a),en.A9.error("Failed to update completion state. Please try again later!")}}),K=(0,b.useMemo)(()=>({name:C,content:I,mark_scheme:P,images:A,maximum_mark:M,id:k,video_solutions:E,audio_clips:q}),[C,I,P,A,M,k,E,q]),Y=(0,b.useCallback)(e=>{O(e),F(!0)},[]),V=(0,b.useCallback)(()=>{let e=_.mT.Complete;a!==e&&(h(k,e),L(e))},[a,k,L,h]),H=c===G||!Z,J=(0,b.useCallback)((e,r)=>{p(t=>({...t,[e]:r}))},[p]),X=w?4:6;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.Z,{children:[W&&(0,s.jsx)(u.nb,{onClose:()=>{F(!1)},contentAccess:B,showTeacherPage:!1}),(0,s.jsxs)(i.Z,{width:"100%",sx:{backgroundColor:v.palette.common.white,borderRadius:.75*v.shape.borderRadius},children:[(0,s.jsx)(i.Z,{p:1.5,pl:2,direction:"row",alignItems:"center",sx:{borderBottom:"1px solid ".concat(v.colors.common.grey[100])},children:(0,s.jsxs)(N.ZP,{container:!0,sx:{alignItems:"center"},children:[(0,s.jsx)(N.ZP,{item:!0,xs:X,children:(0,s.jsx)(l.Z,{noWrap:!0,variant:"p-md-semibold",children:C})}),w&&(0,s.jsx)(N.ZP,{item:!0,xs:4,children:(0,s.jsx)(x.Sv,{value:w})}),(0,s.jsx)(N.ZP,{item:!0,xs:X,sx:{display:"flex",justifyContent:"flex-end"},children:(0,s.jsxs)(i.Z,{direction:"row",spacing:{xs:.5,sm:2},children:[(0,s.jsx)(T.Z,{title:"Give us feedback on this question",children:(0,s.jsx)(z.Z,{size:"large",sx:{padding:0,height:"auto",":hover":{background:"none"}},onClick:()=>U(!0),children:(0,s.jsx)(eo.NA,{sx:{width:44,height:24}})})}),H&&(0,s.jsx)(eT,{disabled:Q,onClick:()=>{if(!Z){Y(e_);return}let e=a===_.mT.Complete?_.mT.Incomplete:_.mT.Complete;h(k,e),L(e)},completionStatus:a})]})})]})}),H?(0,s.jsx)(eA,{caseStudyPart:K,isAuthenticated:Z,onSubmit:V,showAccessDeniedModal:Y,numUsesRemainingInfo:g,refetchNumUsesRemainingInfo:y,requestId:S}):(0,s.jsx)(ew,{partAnswer:m,userCaseStudy:d,caseStudyPart:K,updateCaseStudyPartProgress:J,requestId:S})]})]}),(0,s.jsx)(u.u_,{open:D,onClose:()=>U(!1),containerStyle:{width:{xs:"100%",md:"90%",xl:"60%"},height:{xs:"90%"}},analyticsName:"caseStudyPartFeedback",children:(0,s.jsx)(eE,{caseStudyId:r,caseStudyPartId:t.id,caseStudyPartName:t.name})})]})});var eq=t(47476),eW=t(43856);let eF=(0,b.memo)(function(e){let{caseStudyId:r,sections:t,partsCompletionStateMap:n,mode:a,userCaseStudy:c,setPartsSavedState:d,updateCaseStudyPart:u,numUsesRemainingInfo:m,refetchNumUsesRemainingInfo:p,requestId:x}=e,h=(0,o.Z)(),[g]=(0,eZ.CJ)("CASE_STUDY_QUESTION_GROUPING"),y=$()(null==c?void 0:c.partAnswers,"caseStudyPartId");return g&&t[0]&&t[0].questions.length>1?(0,s.jsx)(i.Z,{className:"caseStudySectionQuestionList",spacing:3,p:3,pl:{xs:3,md:5.5},children:t.map(e=>(0,s.jsxs)(i.Z,{spacing:3,children:[e.name.trim()&&(0,s.jsxs)(i.Z,{spacing:.5,children:[(0,s.jsx)(l.Z,{variant:"h4-bold",textAlign:"center",color:h.colors.common.primary[600],children:e.name}),e.description&&(0,s.jsx)(l.Z,{variant:"p-sm-rg",textAlign:"center",color:h.colors.common.primary[500],children:e.description})]}),(0,s.jsx)(i.Z,{divider:(0,s.jsx)(ee.Z,{flexItem:!0,orientation:"horizontal",sx:{borderColor:h.colors.common.primary[100]}}),children:e.questions.map(e=>(0,s.jsx)(eB,{question:e,caseStudyId:r,partsCompletionStateMap:n,mode:a,userCaseStudy:c,partAnswers:y,setPartsSavedState:d,updateCaseStudyPart:u,numUsesRemainingInfo:m,refetchNumUsesRemainingInfo:p,requestId:x},e.id))})]},e.id))}):(0,s.jsx)(i.Z,{className:"caseStudySectionQuestionList",spacing:3,p:3,pl:{xs:3,md:5.5},children:t.map(e=>(0,s.jsxs)(i.Z,{spacing:3,children:[e.name.trim()&&(0,s.jsxs)(i.Z,{spacing:.5,children:[(0,s.jsx)(l.Z,{variant:"h4-bold",textAlign:"center",color:h.colors.common.primary[600],children:e.name}),e.description&&(0,s.jsx)(l.Z,{variant:"p-sm-rg",textAlign:"center",color:h.colors.common.primary[500],children:e.description})]}),(0,s.jsx)(i.Z,{spacing:1,width:"100%",children:e.questions.flatMap(e=>e.parts.map(e=>{var t;return(0,s.jsx)(eG,{caseStudyId:r,caseStudyPart:e,completionStatus:null!==(t=n[e.id])&&void 0!==t?t:_.mT.Incomplete,mode:a,partAnswer:y[e.id],userCaseStudy:c,setPartsSavedState:d,updateCaseStudyPart:u,numUsesRemainingInfo:m,refetchNumUsesRemainingInfo:p,requestId:x},e.id)}))})]},e.id))})}),eB=e=>{let{question:r,caseStudyId:t,partsCompletionStateMap:n,mode:a,userCaseStudy:c,partAnswers:d,setPartsSavedState:u,updateCaseStudyPart:m,numUsesRemainingInfo:p,refetchNumUsesRemainingInfo:x,requestId:h}=e,g=(0,o.Z)(),[y,j]=(0,b.useState)(!0),S=y?eq.Z:eW.Z;return(0,s.jsxs)(er.Z,{disableGutters:!0,defaultExpanded:!0,sx:{border:"none","&:before":{display:"none"},backgroundColor:"transparent",boxShadow:"none"},expanded:y,onChange:()=>{j(e=>!e)},children:[(0,s.jsx)(et.Z,{expandIcon:(0,s.jsx)(S,{sx:{color:g.colors.common.primary[600]}}),sx:{flexDirection:"row-reverse",pl:2,".MuiAccordionSummary-content":{my:2.25,ml:1}},children:(0,s.jsx)(l.Z,{variant:"p-lg-semibold",children:r.name})}),(0,s.jsx)(es.Z,{sx:{p:0},children:(0,s.jsx)(i.Z,{spacing:1,width:"100%",mb:3,children:r.parts.map(e=>{var r;return(0,s.jsx)(eG,{caseStudyId:t,caseStudyPart:e,completionStatus:null!==(r=n[e.id])&&void 0!==r?r:_.mT.Incomplete,mode:a,partAnswer:d[e.id],userCaseStudy:c,setPartsSavedState:u,updateCaseStudyPart:m,numUsesRemainingInfo:p,refetchNumUsesRemainingInfo:x,requestId:h},e.id)})})})]})};var eO=t(4889),eN=t.n(eO),eD=t(3657),eU=t(76635),ez=t.n(eU),eL=t(1804),eQ=t(61010),eK=t(96643),eY=t(87084),eV=t(64199),eH=t(94668),eJ=t(96802);let eX=eJ.kg.child({from:"CaseStudySubmitDialog"}),e$=e=>{let{sections:r,partsCompletionStateMap:t,open:n,userCaseStudy:c,isDisabled:d,onClose:u,setIsProcessing:p,updateCaseStudyPart:x}=e,{api:h}=(0,R.Qy)(),g=(0,o.Z)(),{contextEntityId:y,submittedFromContextType:b,subjectId:S}=ey(),f=(0,j.useQueryClient)(),[v]=(0,eL.D)(ex.ZT,{client:h.assessment,onCompleted:e=>{let{submitUserCaseStudyV3:r}=e;f.setQueryData(R.iP.userCaseStudy(c.id),r)}}),Z=ez().keyBy(null==c?void 0:c.partAnswers,"caseStudyPartId"),w=r.map(e=>{var r;let t=e.questions.filter(e=>e.type===m.q8j.Optional).map(e=>{let r=ez().sumBy(e.parts,e=>{let r=Z[e.id];return r&&"<p></p>"!==r.answer?e.maximum_mark:0});return{id:e.id,index:e.index,marksAnswered:r}}).sort((e,r)=>r.marksAnswered-e.marksAnswered).slice(0,null!==(r=e.num_optional_questions_to_answer)&&void 0!==r?r:void 0).sort((e,r)=>e.index-r.index).map(e=>e.id);return{id:e.id,name:e.name,parts:e.questions.filter(e=>e.type===m.q8j.Required||t.includes(e.id)).flatMap(e=>e.parts.filter(e=>{var r;return!Z[e.id]||(null===(r=Z[e.id])||void 0===r?void 0:r.answer)==="<p></p>"}).map(e=>({...e})))}}).filter(e=>e.parts.length>0),C=r.flatMap(e=>e.questions.flatMap(e=>e.parts)).filter(e=>{let r=Z[e.id],s=t[e.id],o=r&&"<p></p>"!==r.answer,n=!s||s===_.mT.Incomplete;return o&&n}),k=w.flatMap(e=>e.parts),I=ez().sumBy(k,e=>e.maximum_mark),A=k.length>0,T=_.mT.Complete,{mutate:M}=(0,j.useMutation)({mutationFn:()=>h.caseStudyPartState.bulkUpsertCaseStudyPartStates(C.map(e=>{let{id:r}=e;return{case_study_part_id:r,case_study_id:c.caseStudyId,status:T}})),onError:()=>{C.forEach(e=>{let{id:r}=e;x(r,_.mT.Incomplete)})}});return(0,s.jsx)(eV.Z,{open:n,onClose:u,maxWidth:"md",PaperProps:{sx:{padding:6,rowGap:3,width:"560px",borderRadius:4}},children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eH.Z,{sx:{display:"flex",flexDirection:"column",rowGap:3,padding:0},children:A?(0,s.jsx)(()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(i.Z,{spacing:2,children:[(0,s.jsx)(eo.hL,{sx:{fontSize:"64px"}}),(0,s.jsx)(eQ.Z,{sx:{padding:0},variant:"h4-bold",children:"Looks like there are some questions that have not been answered"})]}),(0,s.jsxs)(i.Z,{spacing:2,children:[(0,s.jsxs)(i.Z,{sx:{padding:2,backgroundColor:g.colors.common.grey[100],borderRadius:.5*g.shape.borderRadius},spacing:2,children:[(0,s.jsxs)(i.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,s.jsx)(l.Z,{variant:"p-sm-rg",children:"Unanswered Questions"}),(0,s.jsxs)(l.Z,{variant:"p-xs-rg",color:g.colors.common.primary[500],children:["Total: [",I," marks]"]})]}),w.map(e=>{let r=e.name.trim();return(0,s.jsxs)(i.Z,{spacing:1,children:[r&&(0,s.jsx)(l.Z,{variant:"p-sm-semibold",children:r}),(0,s.jsx)(i.Z,{direction:"row",columnGap:1,rowGap:1,flexWrap:"wrap",children:e.parts.map(e=>(0,s.jsx)(eY.Z,{label:(0,s.jsxs)("span",{children:[(0,s.jsx)("strong",{children:e.name})," [",e.maximum_mark,"]"]}),sx:{borderRadius:.25*g.shape.borderRadius,backgroundColor:g.palette.common.white,padding:.5,height:"auto",".MuiChip-label":{px:1,fontSize:"0.875rem"}}},e.id))})]},e.id)})]}),(0,s.jsx)(eK.Z,{variant:"p-sm-rg",children:"Submitting this case study will submit your answers to Newton AI for auto-marking. You will not be able to change your answers until the auto-marking has completed."})]})]}),{}):(0,s.jsx)(()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(i.Z,{spacing:2,children:[(0,s.jsx)(eo.rE,{sx:{fontSize:"64px"},fill:g.colors.common.success[500]}),(0,s.jsx)(eQ.Z,{sx:{padding:0},variant:"h4-bold",children:"Submit Case Study?"})]}),(0,s.jsx)(eK.Z,{variant:"p-sm-rg",children:"Submitting this case study will submit your answers to Newton AI for auto-marking. You will not be able to change your answers until the auto-marking has completed."})]}),{})}),(0,s.jsxs)(i.Z,{spacing:2,direction:{xs:"column",md:"row"},children:[(0,s.jsx)(a.Z,{onClick:u,color:"primary",variant:"solid",sx:{textTransform:"none",width:{md:"50%"}},disabled:d,children:"Cancel"}),(0,s.jsx)(a.Z,{onClick:()=>{p(!0),v({variables:{input:{id:c.id,submittedFromContextId:y,submittedFromContext:b,subjectId:S}}}).then(()=>{p(!1),en.A9.success("Case study submitted successfully, please wait for your case study to be marked. Please note that it may take a few minutes",{autoHideDuration:1e4}),u(),b!==P.VV.BootCampSection&&window.scrollTo({behavior:"smooth",top:0})}).catch(e=>{p(!1),eX.error("Failed to submit user case study",{error:e}),en.A9.error("Sorry, there was an issue submitting your case study, try again later, or reach out to us via email.",{autoHideDuration:1e4}),u()}),C.length&&(M(),C.forEach(e=>{let{id:r}=e;x(r,T)}))},color:"primary",variant:"outline",sx:{textTransform:"none",width:{md:"50%"}},disabled:d,children:"Yes, Submit"})]})]})})},e0=(0,R.rL)({api:"assessment"}),e1=e=>{let{open:r,userCaseStudy:t,isProcessing:o,onClose:n,setIsProcessing:l}=e,c=(0,j.useQueryClient)(),[d]=(0,eL.D)(ex.wK,{client:e0,onCompleted:e=>{let{resetUserCaseStudy:r}=e;c.setQueryData(R.iP.userCaseStudy(t.id),r),n(),l(!1)}});return(0,s.jsxs)(eV.Z,{open:r,onClose:n,maxWidth:"md",PaperProps:{sx:{padding:6,rowGap:3,width:"560px",borderRadius:4}},children:[(0,s.jsxs)(eH.Z,{sx:{display:"flex",flexDirection:"column",rowGap:3,padding:0},children:[(0,s.jsxs)(i.Z,{spacing:2,children:[(0,s.jsx)(eo.hL,{sx:{fontSize:"64px"}}),(0,s.jsx)(eQ.Z,{sx:{padding:0},variant:"h4-bold",children:"Are you sure you want to retry this case study?"})]}),(0,s.jsx)(eK.Z,{variant:"p-sm-rg",children:"If you retry this case study, all previous answers will be lost forever."})]}),(0,s.jsxs)(i.Z,{spacing:2,direction:{xs:"column",md:"row"},children:[(0,s.jsx)(a.Z,{onClick:n,color:"primary",variant:"solid",sx:{textTransform:"none",width:{md:"50%"}},disabled:o,children:"Cancel"}),(0,s.jsx)(a.Z,{onClick:()=>{l(!0),d({variables:{id:t.id}})},color:"primary",variant:"outline",sx:{textTransform:"none",width:{md:"50%"}},disabled:o,children:"Yes, retry"})]})]})},e5=eJ.kg.child({from:"CaseStudyFailureDialog"}),e6=(0,R.rL)({api:"assessment"}),e2=e=>{let{userCaseStudy:r,open:t,isProcessing:n,onClose:l,setIsProcessing:c}=e,{contextEntityId:d,submittedFromContextType:u,subjectId:m}=ey(),p=(0,o.Z)(),x=(0,j.useQueryClient)(),[h]=(0,eL.D)(ex.ZT,{client:e6,onCompleted:e=>{let{submitUserCaseStudyV3:t}=e;x.setQueryData(R.iP.userCaseStudy(r.id),t)}});return(0,s.jsxs)(eV.Z,{open:t,onClose:l,maxWidth:"md",PaperProps:{sx:{padding:6,rowGap:3,width:"560px",borderRadius:4}},children:[(0,s.jsxs)(eH.Z,{sx:{display:"flex",flexDirection:"column",rowGap:3,padding:0},children:[(0,s.jsxs)(i.Z,{spacing:2,children:[(0,s.jsx)(eo.oC,{sx:{fontSize:"64px"},fill:p.colors.common.brick[400]}),(0,s.jsx)(eQ.Z,{sx:{padding:0},variant:"h4-bold",children:"Looks like there was an error submitting your case study!"})]}),(0,s.jsxs)(eK.Z,{variant:"p-sm-rg",children:["Please try again. If the issue persists, please reach out to us via email"," ",(0,s.jsx)("strong",{children:"info@revisionvillage.com"}),"."]})]}),(0,s.jsxs)(i.Z,{spacing:2,direction:{xs:"column",md:"row"},children:[(0,s.jsx)(a.Z,{onClick:l,color:"primary",variant:"solid",sx:{textTransform:"none",width:{md:"50%"}},disabled:n,children:"Cancel"}),(0,s.jsx)(a.Z,{onClick:()=>{c(!0),h({variables:{input:{id:r.id,submittedFromContextId:d,submittedFromContext:u,subjectId:m}}}).then(()=>{c(!1),en.A9.success("Case study resubmitted, please wait for your case study to be marked. Please note that it may take a few minutes",{autoHideDuration:1e4}),l()}).catch(e=>{c(!1),e5.error("Failed to resubmit user case study",{error:e}),en.A9.error("Sorry, there was an issue resubmitting your case study, try again later, or reach out to us via email.",{autoHideDuration:1e4}),l()})},color:"primary",variant:"outline",sx:{textTransform:"none",width:{md:"50%"}},disabled:n,children:"Resubmit"})]})]})};var e4=t(28783);let e3=e=>{let{sections:r,totalMarks:t,partsCompletionStateMap:n,userCaseStudy:c,partsSavedState:d,updateCaseStudyPart:x,limitSubmissions:h,openRetryDialog:g,setOpenRetryDialog:y}=e,j=(0,o.Z)(),{completedAt:S,submissionCount:v}=c,[Z,w]=(0,b.useState)(!1),[C,k]=(0,b.useState)(!1),[I,R]=(0,b.useState)(!1),[A,M]=(0,b.useState)(!1);(0,b.useEffect)(()=>{c.markingStatus===P.L4.Error&&k(!0)},[c.markingStatus]);let E=$()(c.partAnswers,"caseStudyPartId"),_=r.reduce((e,r)=>{var t;let s=r.questions.filter(e=>e.type===m.q8j.Optional),o=null!==(t=r.num_optional_questions_to_answer)&&void 0!==t?t:s.length,n=r.questions.map(e=>{let r=e.parts.reduce((e,r)=>{let t=E[r.id];return t&&"<p></p>"!==t.answer?e+r.maximum_mark:e},0);return{id:e.id,type:e.type,marksAnswered:r}}),i=eN()(n.filter(e=>e.type===m.q8j.Optional).sort((e,r)=>r.marksAnswered-e.marksAnswered).slice(0,o),e=>e.marksAnswered);return e+eN()(n.filter(e=>e.type===m.q8j.Required),e=>e.marksAnswered)+i},0),G=Math.round(_/t*100),q=Object.values(d).every(e=>!e)&&c.partAnswers&&c.partAnswers.length>0,W=Math.max(2-(null!=v?v:0),0);return(0,s.jsxs)(s.Fragment,{children:[A&&(0,s.jsx)(u.nb,{onClose:()=>{M(!1)},contentAccess:{isAccessible:!1,reason:ei.KG.RequiresPaid},showTeacherPage:!1}),(0,s.jsx)(i.Z,{direction:"row",position:"sticky",bottom:0,width:"100%",pl:2.5,sx:{backgroundColor:j.palette.common.white},children:(0,s.jsx)(f.Z,{maxWidth:"xl",children:S?(0,s.jsxs)(i.Z,{className:"caseStudySubmit",direction:"row",justifyContent:"space-between",alignItems:"center",width:"100%",sx:{p:j.spacing(1.5,3)},children:[(0,s.jsx)(l.Z,{variant:"p-md-rg",color:j.colors.common.primary[400],children:"Great Work!"}),c.markingStatus===P.L4.Error?(0,s.jsx)(T.Z,{title:"There was an error. You can re-submit your case study.",children:(0,s.jsx)("span",{children:(0,s.jsx)(a.Z,{variant:"solid",color:"primary",endIcon:(0,s.jsx)(eD.Z,{}),onClick:()=>k(!0),disabled:I,children:"Resubmit"})})}):(0,s.jsx)(T.Z,{title:"You can retry this once your case study has been marked.",children:(0,s.jsx)("span",{children:(0,s.jsx)(a.Z,{variant:"solid",color:"primary",startIcon:(0,s.jsx)(p.zy,{fill:j.palette.common.white}),disabled:I||c.markingStatus!==P.L4.AutomarkingCompleted,onClick:()=>y(!0),children:"Retry"})})})]}):(0,s.jsxs)(i.Z,{className:"caseStudySubmit",direction:"row",justifyContent:"space-between",alignItems:"center",width:"100%",sx:{p:j.spacing(1.5,3)},children:[h&&(0,s.jsxs)(u.Vp,{typographyProps:{textTransform:"lowercase",variant:"p-xs-rg",mr:.5},sx:{position:"absolute",bottom:"100%",left:0,bgcolor:j.colors.common.brick[400],px:1,py:.2,color:"white",borderRadius:"4px 4px 0 0",lineHeight:1.333},icon:(0,s.jsx)(T.Z,{title:"Free users can only have two submissions.",children:(0,s.jsx)(e4.Z,{fontSize:"small"})}),children:[0===W?"No":W," free submission",1===W?"":"s"," ","remaining"]}),(0,s.jsx)(T.Z,{title:"You have answered ".concat(_,"/").concat(t," marks"),children:(0,s.jsxs)(l.Z,{variant:"p-md-rg",color:j.colors.common.primary[400],children:[null!=G?G:0,"% complete"]})}),(0,s.jsx)(a.Z,{variant:"solid",color:"primary",onClick:()=>{if(h&&W<=0){M(!0);return}w(!0)},disabled:I||!q,children:"Submit for feedback"})]})})}),(0,s.jsx)(e$,{sections:r,partsCompletionStateMap:n,open:Z,userCaseStudy:c,isDisabled:I||!q,onClose:()=>w(!1),setIsProcessing:R,updateCaseStudyPart:x}),(0,s.jsx)(e1,{open:g,userCaseStudy:c,isProcessing:I,onClose:()=>y(!1),setIsProcessing:R}),(0,s.jsx)(e2,{open:C,userCaseStudy:c,isProcessing:I,onClose:()=>k(!1),setIsProcessing:R})]})},e8={1:{title:"Room for Growth",feedback:"Your submitted responses were assessed to be substantially incomplete and/or incorrect. Fundamental errors and omissions were present. Be sure to answer all questions to the best of your ability!"},2:{title:"Room for Growth",feedback:"Be sure to focus on the guiding question and each particular smaller step. Read with attention and annotate important information to incorporate in your answers. Be sure to complete all responses and complete the task. Keep practicing!"},3:{title:"Room for Growth",feedback:"Some understanding of the text with some insight. Keep practicing your analysis and aim to develop the answers a bit more! Be sure to complete all responses. Keep working!"},4:{title:"Good Start!",feedback:"Solid work, but with room for improvement! Be sure to attend to your overall structure and careful use and analysis of textual evidence as you continue to revise. You can do this!"},5:{title:"Nice Work!",feedback:"Well done! Good response with a clear understanding of the text. Aim to explore the text more thoroughly and look for more details and subtleties with more discussion of richer implications. Remember to always support your work with textual evidence. You can do this!"},6:{title:"Excellent!",feedback:"Very good work! This shows an exploration of the text with insightful interpretation of many authorial choices. Make sure you consider nuances of the text and always include effective textual evidence to support your answers. Keep working hard!"},7:{title:"Stellar!",feedback:"Outstanding response that explores many nuances of the text. This shows a sophisticated understanding and insightful analysis of authorial choices. Well done! Keep working hard to achieve consistency in your results."}},e7=e=>{let{userCaseStudy:r,totalMarks:t,showCaseStudyGeneratedOverallFeedback:s}=e;if(!r||r.markingStatus!==P.L4.AutomarkingCompleted||!r.markingDetails)return;let{totalMarksObtained:o,percentageMarksObtained:n}=r.markingDetails;if(s){var i,a;let e=e9(n),s=e8[e];return{marksAchieved:o,maxPossibleMarks:t,percentage:n,grade:null!==(i=r.overallGrade)&&void 0!==i?i:e,maxGrade:7,...s,feedback:null!==(a=r.overallFeedback)&&void 0!==a?a:s.feedback}}let l=e9(n),c=e8[l];return{marksAchieved:o,maxPossibleMarks:t,percentage:n,grade:l,maxGrade:7,...c}},e9=e=>e>=75?7:e>=66?6:e>=56?5:e>=46?4:e>=35?3:e>=14?2:1;var re=t(64665),rr=t(44781);let rt="undefined"!=typeof navigator&&/iPad|iPhone|iPod/.test(navigator.userAgent),rs=e=>{let{open:r,setDrawerOpen:t,children:i}=e,a=(0,o.Z)();return(0,s.jsxs)(re.Z,{anchor:"bottom",open:r,onClose:()=>t(!1),onOpen:()=>t(!0),swipeAreaWidth:56,disableSwipeToOpen:!1,disableBackdropTransition:!rt,disableDiscovery:rt,disableRestoreFocus:!0,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"}},PaperProps:{sx:{height:"calc(80% - ".concat(56,"px)"),overflow:"visible"}},children:[(0,s.jsxs)(n.Z,{sx:{position:"absolute",top:-56,borderTopLeftRadius:8,borderTopRightRadius:8,visibility:"visible",right:0,left:0,backgroundColor:a.colors.common.grey[100]},children:[(0,s.jsx)(ro,{}),(0,s.jsx)(l.Z,{variant:"p-md-rg",sx:{p:2,color:a.colors.common.primary[600]},children:r?"Close Extracts":"See Extracts"})]}),(0,s.jsx)(n.Z,{sx:{height:"100%",overflow:"auto"},children:i})]})},ro=(0,rr.ZP)("div")(e=>{let{theme:r}=e;return{width:30,height:6,backgroundColor:r.palette.grey[300],borderRadius:3,position:"absolute",top:8,left:"calc(50% - 15px)"}});var rn=t(47591),ri=t(95406);let ra=()=>{let{color:e}=(0,ri.jS)(),r=(0,o.Z)();return(0,s.jsxs)(i.Z,{sx:{borderRadius:.75*r.shape.borderRadius,backgroundColor:(0,rn.Fq)(e[50],.5),p:3},spacing:1,children:[(0,s.jsx)(l.Z,{variant:"p-md-semibold",color:r.colors.common.primary[600],children:"Auto-Marking in Progress"}),(0,s.jsx)(l.Z,{variant:"p-sm-rg",color:r.colors.common.primary[600],children:"You have submitted the case study and Newton AI is now working on marking your answers. Auto-marking can take up to 24 hours to complete. Please come back later to see your results."})]})},rl=e=>{let{subjectGroupSlug:r}=e,t=(0,o.Z)(),{caseStudyHelpUrl:n}=(0,eM.JR)();return(0,s.jsxs)(d(),{href:"".concat(n,"/").concat(r,"-case-studies"),target:"_blank",style:{display:"flex",alignItems:"center",color:t.colors.common.primary[400],textDecoration:"none"},children:[(0,s.jsx)(l.Z,{variant:"p-sm-rg",children:"How do I use this resource?"}),(0,s.jsx)(p.sz,{sx:{ml:.5,width:"16px",height:"16px"},htmlColor:t.colors.common.primary[600]})]})};var rc=t(94059),rd=t(38510);let ru=(0,b.memo)(function(e){let{guiding_question:r,color:t}=e,[o,a]=(0,b.useState)(!0),{color:c}=(0,ri.oI)(),d=null!=t?t:c,u={color:d[800]};return(0,s.jsx)(n.Z,{sx:{background:d[300]},children:(0,s.jsx)(f.Z,{maxWidth:"xl",children:(0,s.jsxs)(er.Z,{expanded:o,onChange:()=>{a(e=>!e)},sx:{background:"transparent",boxShadow:"transparent 0 0"},children:[(0,s.jsxs)(et.Z,{sx:{".MuiAccordionSummary-content":{marginTop:"20px",marginBottom:"".concat(o?"12px":"20px")}},children:[o?(0,s.jsx)(rd.Z,{sx:{fontSize:"2rem",...u}}):(0,s.jsx)(rc.Z,{sx:{fontSize:"2rem",...u}}),(0,s.jsx)(l.Z,{variant:"h4-bold",pl:1,sx:{lineHeight:"2rem",...u},children:"Guiding Question"})]}),(0,s.jsx)(es.Z,{sx:{paddingBottom:3,paddingTop:0},children:(0,s.jsx)(i.Z,{justifyContent:"center",p:3,sx:{margin:"0 44px",borderRadius:"16px",border:"1px solid ".concat(u.color),backgroundColor:"white",...u},children:(0,s.jsx)(l.Z,{variant:"p-md-rg",children:r})})})]})})})}),rm=(0,b.memo)(function(e){let{guiding_question:r}=e,[t,n]=(0,b.useState)(!0),a=(0,o.Z)(),{color:c}=(0,ri.jS)();return(0,s.jsx)(i.Z,{sx:{py:2.5,backgroundColor:c[100],borderTop:"1px solid ".concat(c[50])},children:(0,s.jsx)(f.Z,{maxWidth:"xl",children:(0,s.jsxs)(er.Z,{disableGutters:!0,expanded:t,onChange:()=>{n(e=>!e)},sx:{background:"transparent",boxShadow:"none"},children:[(0,s.jsx)(et.Z,{expandIcon:(0,s.jsx)(z.Z,{size:"small",sx:{"&&":{backgroundColor:c[50]}},children:(0,s.jsx)(p.pO,{})}),sx:{flexDirection:"row-reverse",pl:0,minHeight:0,".MuiAccordionSummary-content":{m:0},".MuiAccordionSummary-expandIconWrapper.Mui-expanded":{transform:"rotate(-180deg)"}},children:(0,s.jsx)(l.Z,{variant:"p-md-semibold",pl:1.5,color:a.colors.common.primary[600],children:"Guiding Question"})}),(0,s.jsx)(es.Z,{sx:{p:a.spacing(0,0,1.5)},children:(0,s.jsx)(i.Z,{ml:"44px",mt:2.5,children:(0,s.jsx)(l.Z,{variant:"p-md-rg",color:a.colors.common.primary[600],children:r})})})]})})})}),rp=e=>{let{score:r}=e,t=(0,o.Z)();return(0,s.jsxs)(i.Z,{sx:{p:5,backgroundColor:t.colors.common.primary[600],borderRadius:.5*t.shape.borderRadius,flexShrink:0,alignItems:"center",justifyContent:"center",width:"fit-content"},spacing:1,children:[(0,s.jsxs)(i.Z,{direction:"row",spacing:2,alignItems:"center",children:[(0,s.jsx)(l.Z,{component:"p",variant:"h1-bold",color:t.palette.common.white,children:r.grade}),(0,s.jsx)(p.XZ,{sx:{width:12,height:32}}),(0,s.jsx)(l.Z,{component:"p",variant:"h1-bold",color:t.palette.common.white,children:r.maxGrade})]}),(0,s.jsxs)(l.Z,{variant:"p-sm-rg",color:t.colors.common.primary[200],children:["Score: ",r.percentage,"%"]})]})},rx=e=>{let{score:r,onRetry:t}=e,{color:n}=(0,ri.jS)(),c=(0,o.Z)(),{title:d,feedback:u}=r;return(0,s.jsxs)(i.Z,{sx:{backgroundColor:(0,rn.Fq)(n[50],.5),borderRadius:.75*c.shape.borderRadius,width:"100%"},children:[(0,s.jsxs)(i.Z,{sx:{p:3,borderBottom:"2px solid ".concat(n[100])},direction:{xs:"column",md:"row"},spacing:4,children:[(0,s.jsx)(rp,{score:r}),(0,s.jsxs)(i.Z,{spacing:1,children:[(0,s.jsx)(l.Z,{variant:"p-md-semibold",color:c.colors.common.primary[600],children:d}),(0,s.jsx)(l.Z,{variant:"p-sm-md",color:c.colors.common.primary[600],children:u})]})]}),(0,s.jsx)(i.Z,{sx:{p:1,alignItems:{xs:"flex-start",md:"center"}},children:(0,s.jsx)(a.Z,{variant:"ghost",color:"primary",startIcon:(0,s.jsx)(p.zy,{}),onClick:t,children:"Retry in Examination Mode"})})]})},rh=e=>{let{processedMode:r,onModeChange:t,modeEnabled:o,shouldShowAutoMarkingBanner:n,guidingQuestion:a,score:l,onRetry:c}=e,{subjectGroupSlug:d,accessContextType:u}=ey(),{color:m}=(0,ri.jS)();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Z,{sx:{py:2.5,backgroundColor:m[100]},children:(0,s.jsx)(f.Z,{maxWidth:"xl",children:(0,s.jsxs)(i.Z,{spacing:2,children:[(0,s.jsxs)(i.Z,{direction:{xs:"column",md:"row"},justifyContent:{xs:"flex-start",md:"space-between"},spacing:1,children:[(0,s.jsx)(F,{mode:r,setMode:t,modeEnabled:o}),u===I.Ar.CaseStudyGroup&&(0,s.jsx)(rl,{subjectGroupSlug:d})]}),n&&(0,s.jsx)(ra,{}),l&&(0,s.jsx)(rx,{score:l,onRetry:c})]})})}),a&&(0,s.jsx)(rm,{guiding_question:a})]})};function rg(e){return e===m.Fo1.Exam?q:G}let ry=e=>{let{subjectName:r,caseStudy:t,sections:l,partsCompletionStateMap:c,extracts:d,userCaseStudy:x,updateCaseStudyPart:h,caseStudyContentAccess:g,requestId:y}=e,{api:A}=(0,R.Qy)(),{isSignedIn:T}=(0,w.aC)(),[M]=(0,eZ.CJ)("CASE_STUDY_GENERATED_OVERALL_FEEDBACK"),E=(0,o.Z)(),{subjectId:_,extractsPath:G}=ey(),{data:W,refetch:F}=(0,j.useQuery)(R.iP.newtonUsesRemainingForSubject(_),async()=>{if(!T)return;let{data:{getFeedbackResponseUsesRemainingV2:e}}=await A.aitutor.query({query:k.Kh,variables:{subjectId:_}});return e}),{isAccessible:B}=g,{name:O,description:N,guiding_question:D,mode_enabled:U}=t,[z,L]=(0,b.useState)(["50%","auto"]),[Q,K]=(0,b.useState)(!0),[Y,V]=(0,b.useState)(!B),[H,X]=(0,b.useState)({}),[$,ee]=(0,b.useState)(!1),[{mode:er},{mode:et}]=(0,C.KZ)(["mode"],{mode:rg(U)}),es="85vh",eo=!!x,en=eo&&U===m.Fo1.All?er:rg(U),ei=eo&&en===q,ea=(null==x?void 0:x.markingStatus)===P.L4.InProgress,el=e7({userCaseStudy:x,totalMarks:t.total_marks,showCaseStudyGeneratedOverallFeedback:M});(0,b.useEffect)(()=>{V(!B)},[B]);let ec=(0,b.useCallback)(e=>{eo?et(e):V(!0)},[eo,et]),ed=(0,b.useCallback)(()=>{K(!1),window.open(null!=G?G:"./extracts","_blank")},[K,G]),eu=(0,b.useCallback)(()=>{F()},[F]),[em,ep]=(0,b.useState)(!1),ex=(0,b.useMemo)(()=>(0,s.jsx)(rs,{open:em,setDrawerOpen:ep,children:(0,s.jsx)(J,{caseStudy:t,caseStudyExtracts:d,onOpenNewTab:ed,ephemeralId:y,useEncryption:!0})}),[t,em,d,ed,y]),eh=(0,b.useMemo)(()=>(0,s.jsxs)(i.Z,{children:[(0,s.jsx)(eF,{sections:l,caseStudyId:t.id,partsCompletionStateMap:c,mode:en,userCaseStudy:x,setPartsSavedState:X,updateCaseStudyPart:h,numUsesRemainingInfo:W,refetchNumUsesRemainingInfo:eu,requestId:y}),ei&&(0,s.jsx)(e3,{sections:l,totalMarks:t.total_marks,partsCompletionStateMap:c,userCaseStudy:x,partsSavedState:H,updateCaseStudyPart:h,limitSubmissions:(null==W?void 0:W.allocationType)===I.aj.AllTime,openRetryDialog:$,setOpenRetryDialog:ee})]}),[l,t.id,t.total_marks,c,en,x,h,W,eu,ei,H,$,y]);return(0,s.jsxs)(s.Fragment,{children:[Y&&(0,s.jsx)(u.nb,{onClose:()=>{B&&V(!1)},contentAccess:B?e_:g,showTeacherPage:!1}),(0,s.jsx)(Z.cQ,{title:r,secondTitleLine:O,description:N,FeatureIcon:p.IG,showSubjectGroupIcon:!1}),(0,s.jsx)(rh,{processedMode:en,onModeChange:ec,modeEnabled:U,shouldShowAutoMarkingBanner:ea,guidingQuestion:D,score:el,onRetry:()=>{er!==q&&ec(q),ee(!0)}}),B&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.Z,{sx:{display:{xs:"block",md:"none"}},children:[(0,s.jsx)(n.Z,{sx:{backgroundColor:E.colors.common.grey[100]},children:eh}),ex]}),(0,s.jsx)(n.Z,{sx:{display:{xs:"none",md:"block"},backgroundColor:Q?E.colors.common.grey[200]:E.colors.common.grey[100]},children:Q?(0,s.jsx)(f.Z,{maxWidth:"xl",sx:{maxWidth:"1800px !important"},children:(0,s.jsx)(n.Z,{sx:{height:es,py:4},children:(0,s.jsxs)(S.ZP,{split:"vertical",sizes:z,onChange:L,sashRender:e=>(0,s.jsx)(i.Z,{width:20,height:"100%",justifyContent:"center",alignItems:"center",sx:{backgroundColor:E.colors.common.primary[100]},children:(0,s.jsx)(n.Z,{sx:{fontSize:"1rem",color:E.colors.common.primary[600]},children:(0,s.jsx)(v.Z,{fontSize:"inherit",color:"inherit"})})},e),children:[(0,s.jsx)(S.X6,{minSize:400,style:{backgroundColor:E.palette.common.white,borderTopLeftRadius:6*E.shape.borderRadius,borderBottomLeftRadius:6*E.shape.borderRadius,position:"relative"},children:(0,s.jsx)(J,{caseStudy:t,caseStudyExtracts:d,onOpenNewTab:ed,ephemeralId:y,useEncryption:!0})}),(0,s.jsxs)(S.X6,{minSize:400,style:{maxHeight:es,overflowY:"auto",top:0,borderTopRightRadius:6*E.shape.borderRadius,borderBottomRightRadius:6*E.shape.borderRadius,backgroundColor:E.colors.common.grey[100]},children:[(0,s.jsx)(eF,{caseStudyId:t.id,sections:l,partsCompletionStateMap:c,mode:en,userCaseStudy:x,setPartsSavedState:X,updateCaseStudyPart:h,numUsesRemainingInfo:W,refetchNumUsesRemainingInfo:eu,requestId:y}),ei&&(0,s.jsx)(e3,{sections:l,totalMarks:t.total_marks,partsCompletionStateMap:c,userCaseStudy:x,partsSavedState:H,updateCaseStudyPart:h,limitSubmissions:(null==W?void 0:W.allocationType)===I.aj.AllTime,openRetryDialog:$,setOpenRetryDialog:ee})]})]})})}):(0,s.jsxs)(n.Z,{sx:{".caseStudySubmit":{px:0},"&>.MuiStack-root":{pl:0,borderBottom:"1px solid ".concat(E.palette.grey[200])},".caseStudySectionQuestionList":{px:0}},children:[(0,s.jsx)(f.Z,{maxWidth:"xl",children:(0,s.jsxs)(n.Z,{py:3,children:[(0,s.jsx)(i.Z,{width:"100%",alignItems:"flex-start",children:(0,s.jsx)(a.Z,{variant:"ghost",color:"primary",onClick:()=>{K(!0)},startIcon:(0,s.jsx)(p.zN,{}),children:"Show extracts"})}),(0,s.jsx)(eF,{caseStudyId:t.id,sections:l,partsCompletionStateMap:c,mode:en,userCaseStudy:x,setPartsSavedState:X,updateCaseStudyPart:h,numUsesRemainingInfo:W,refetchNumUsesRemainingInfo:eu,requestId:y})]})}),ei&&(0,s.jsx)(e3,{sections:l,totalMarks:t.total_marks,partsCompletionStateMap:c,userCaseStudy:x,partsSavedState:H,updateCaseStudyPart:h,limitSubmissions:(null==W?void 0:W.allocationType)===I.aj.AllTime,openRetryDialog:$,setOpenRetryDialog:ee})]})})]})]})},rb=e=>{let{caseStudies:r,basePath:t,contentAccess:o,caseStudySuperGroupSlug:n,caseStudyGroupSlug:i,setUserCanAccessContent:a,caseStudyProgressMap:l,caseStudyGroupId:c}=e,{user:d}=(0,E.v$)(),u=(null==d?void 0:d.type)===_.FW.Admin?r:r.filter(e=>e.status!==m.kZP.AdminOnly&&e.status!==m.kZP.PublishedRestricted);return(0,s.jsx)(s.Fragment,{children:u.map(e=>{let r=o[e.id],{isAccessible:d}=r,u=l["".concat(c,"/").concat(e.id)],m=d?"".concat(t,"/case-studies/").concat(n,"/").concat(i,"/").concat(e.slug):"javascript:;";return(0,s.jsx)(N.ZP,{item:!0,xs:12,sm:6,lg:4,xl:3,children:(0,s.jsx)(h,{caseStudy:e,href:m,onClick:()=>{d||a(r)},accessLevel:e.access_level,isAccessible:d,progressPercentage:u})},e.id)})})},rj=[p.h1,p.Ej,p.X7,p.OW],rS=(e,r,t)=>(0,s.jsx)(u.ig,{Icon:e,base:r[50],accent:r[600],sx:{width:64,height:64,...t}}),rf=(e,r)=>rj.map(t=>({Icon:rS(t,e,r)})),rv={"unity-and-diversity":p.qF,"form-and-function":p.CI,"interaction-and-interdependence":p.eq,"continuity-and-change":p.dt,"full-length-drq":p.sP,"focused-drq":p.MW,"introduction-to-business-management":p.V6,"human-resource-management":p.kJ,"finance-and-accounts":p.h4,marketing:p.gJ,"operations-management":p.mW,"paper-1-case-studies":p.OW,"paper-1-and-paper-3-case-studies":p.OW,humans:eo.wP,nature:eo.NQ,"paper-1-textual-insight":p.h1,"paper-1-guided-literary-exploration":p.h1,"paper-1-building-a-full-response":p.nZ,"paper-2-literary-lens":p.Ej,"paper-2-literary-connections":p.X7,"paper-2-reading":p.Ix,"paper-2-listening":p.Ck},rZ=(e,r)=>Object.fromEntries(Object.entries(rv).map(t=>{let[s,o]=t;return[s,{Icon:rS(o,e,r)}]})),rw=function(e){let{groups:r,activeId:t,hashParam:a}=e,c=(0,o.Z)(),{color:u}=(0,ri.jS)();return(0,s.jsx)(n.Z,{sx:{backgroundColor:u[100]},children:(0,s.jsx)(f.Z,{maxWidth:"xl",sx:{py:{xs:6,md:8}},children:(0,s.jsx)(N.ZP,{container:!0,spacing:2,children:r.map((e,o)=>{var n;let m=null===(n=rZ(u,{borderRadius:c.shape.borderRadius,p:1.5})[e.slug])||void 0===n?void 0:n.Icon,{Icon:x}=rf(u,{borderRadius:c.shape.borderRadius,p:1.5})[o%rj.length];return(0,s.jsx)(N.ZP,{item:!0,xs:12,sm:6,lg:4,xl:4===r.length?3:4,children:(0,s.jsx)(i.Z,{sx:{backgroundColor:c.palette.common.white,borderRadius:c.shape.borderRadius,p:2.5,boxShadow:t==e.id?1:"none",height:"100%",transition:"transform 300ms","&:hover":{transform:"translateY(-5px)"}},children:(0,s.jsxs)(i.Z,{href:"#".concat(a,"=").concat(e.slug),component:d(),sx:{textDecoration:"none",height:"100%",justifyContent:"space-between"},children:[(0,s.jsxs)(i.Z,{rowGap:3,pb:1.5,children:[null!=m?m:x,(0,s.jsxs)(i.Z,{rowGap:1.5,children:[(0,s.jsx)(l.Z,{variant:"h4-bold",color:c.colors.common.primary[600],children:e.name}),(0,s.jsx)(l.Z,{variant:"p-sm-rg",overflow:"hidden",textOverflow:"ellipsis",color:c.colors.common.primary[600],sx:{lineHeight:1.5,WebkitLineClamp:3,WebkitBoxOrient:"vertical",display:"-webkit-box"},children:e.description})]})]}),(0,s.jsx)(i.Z,{alignItems:"flex-end",children:(0,s.jsx)(p.P5,{sx:{width:48,height:48,fill:t==e.id?(0,rn.Fq)(c.colors.common.primary[600],.08):"none"}})})]})})},e.id)})})})})},rC=e=>{var r;let{activeIndex:t,activeGroup:a,hashParam:c}=e,d=(0,o.Z)(),{color:u}=(0,ri.jS)(),{slug:m,name:p,description:x}=a,h=null===(r=rZ(u,{width:80,height:80,borderRadius:d.shape.borderRadius,p:2})[m])||void 0===r?void 0:r.Icon,{Icon:g}=rf(u,{width:80,height:80,borderRadius:d.shape.borderRadius,p:2})[t%rj.length];return(0,s.jsxs)(i.Z,{id:"".concat(c,"=").concat(m),p:5,sx:{p:5,backgroundColor:d.palette.common.white,borderRadius:1.5*d.shape.borderRadius,scrollMarginTop:"120px"},spacing:2,direction:{xs:"column-reverse",md:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},children:[(0,s.jsxs)(i.Z,{spacing:1,children:[(0,s.jsxs)(i.Z,{direction:"row",spacing:1,children:[(0,s.jsx)(l.Z,{variant:"h2-bold",color:d.colors.common.primary[600],children:p}),(0,s.jsx)(n.Z,{href:"#".concat(c,"=").concat(m),component:"a",sx:{visibility:"hidden"}})]}),(0,s.jsx)(l.Z,{variant:"p-md-rg",color:d.colors.common.primary[600],children:x})]}),(0,s.jsx)(i.Z,{children:null!=h?h:g})]})},rk="cssg",rI=e=>{let{caseStudySuperGroups:r,basePath:t,contentAccess:a,caseStudyProgressMap:c}=e,[{cssg:d}]=(0,C.KZ)([rk]),[m,p]=(0,b.useState)(null),x=(0,o.Z)(),h=Math.max(r.findIndex(e=>e.slug===d),0),g=r[h],{slug:y,caseStudyGroups:j,id:S}=g;return(0,s.jsxs)(s.Fragment,{children:[m&&(0,s.jsx)(u.nb,{onClose:()=>{p(null)},contentAccess:m,showTeacherPage:!1}),(0,s.jsx)(rw,{groups:r,activeId:S,hashParam:rk}),(0,s.jsx)(n.Z,{sx:{backgroundColor:x.colors.common.grey[100],py:{xs:6,md:8}},children:(0,s.jsx)(f.Z,{maxWidth:"xl",children:(0,s.jsx)(rC,{activeIndex:h,activeGroup:g,hashParam:rk})})}),(0,s.jsx)(n.Z,{sx:{"& .caseStudyGroupBlock:nth-of-type(odd)":{backgroundColor:x.colors.common.grey[100]},"& .caseStudyGroupBlock:nth-of-type(even)":{backgroundColor:x.palette.common.white},"& .caseStudyGroupBlock:first-of-type":{paddingTop:0}},children:j.map(e=>(0,s.jsx)(n.Z,{py:{xs:6,md:8},className:"caseStudyGroupBlock",children:(0,s.jsx)(f.Z,{maxWidth:"xl",children:(0,s.jsxs)(i.Z,{spacing:4,children:[(0,s.jsx)(l.Z,{variant:"h4-bold",color:x.colors.common.primary[600],children:e.name}),(0,s.jsx)(i.Z,{children:(0,s.jsx)(N.ZP,{container:!0,spacing:2,children:(0,s.jsx)(rb,{caseStudies:e.caseStudies,basePath:t,contentAccess:a,caseStudySuperGroupSlug:y,caseStudyGroupSlug:e.slug,caseStudyGroupId:e.id,setUserCanAccessContent:p,caseStudyProgressMap:c})})})]})})},e.id))})]})},rP=e=>{let{caseStudySuperGroups:r,basePath:t,contentAccess:a,caseStudyProgressMap:l}=e,c=(0,o.Z)(),[d,m]=(0,b.useState)(null),[{csg:p}]=(0,C.KZ)(["csg"]),x=Math.max(r[0].caseStudyGroups.findIndex(e=>e.slug===p),0),h=r[0].caseStudyGroups[x],{slug:g,caseStudies:y,id:j}=h;return(0,s.jsxs)(s.Fragment,{children:[d&&(0,s.jsx)(u.nb,{onClose:()=>{m(null)},contentAccess:d,showTeacherPage:!1}),(0,s.jsx)(rw,{groups:r[0].caseStudyGroups,activeId:j,hashParam:"csg"}),(0,s.jsx)(n.Z,{sx:{backgroundColor:c.colors.common.grey[100],py:{xs:6,md:8}},children:(0,s.jsxs)(f.Z,{maxWidth:"xl",children:[(0,s.jsx)(rC,{activeIndex:x,activeGroup:h,hashParam:"csg"}),(0,s.jsx)(i.Z,{sx:{mt:{xs:6,md:8}},children:(0,s.jsx)(N.ZP,{container:!0,spacing:2,children:(0,s.jsx)(rb,{caseStudies:y,basePath:t,contentAccess:a,caseStudySuperGroupSlug:r[0].slug,caseStudyGroupSlug:g,caseStudyGroupId:j,setUserCanAccessContent:m,caseStudyProgressMap:l})})})]})})]})},rR=e=>{var r;let{caseStudy:t,subjectFullName:o,subjectFullNameShort:n,sections:i,partsCompletionStateMap:a,extracts:l,userCaseStudy:c,caseStudyContentAccess:d,subjectId:u,subjectLabels:m,showRichTextToolbar:p,subjectGroupSlug:x,contextEntityId:h,accessContextType:g,submittedFromContextType:y,extractsPath:S,requestId:f}=e,{api:v}=(0,R.Qy)(),[Z,w]=(0,b.useState)(a),{data:C}=(0,j.useQuery)(R.iP.userCaseStudy(null!==(r=null==c?void 0:c.id)&&void 0!==r?r:""),()=>{var e;return v.assessment.query({query:ex.cK,variables:{id:null!==(e=null==c?void 0:c.id)&&void 0!==e?e:""}}).then(e=>e.data.userCaseStudy)},{enabled:!!(null==c?void 0:c.id),refetchInterval:e=>null!=e&&!!e.completedAt&&![P.L4.AutomarkingCompleted,P.L4.Error].includes(null==e?void 0:e.markingStatus)&&1e4});(0,b.useEffect)(()=>{a&&w(a)},[a]);let k=(0,b.useCallback)((e,r)=>{w(t=>({...t,[e]:r}))},[w]),I=(0,b.useMemo)(()=>({subjectGroupSlug:x,subjectId:u,contextEntityId:h,accessContextType:g,submittedFromContextType:y,subjectLabels:m,showRichTextToolbar:p,extractsPath:S,subjectCaseStudyName:"".concat(o," - ").concat(t.name)}),[x,u,h,g,y,m,p,S,t.name,o]);return(0,s.jsx)(eg.Provider,{value:I,children:(0,s.jsx)(O.Z,{theme:V.rS,children:(0,s.jsx)(ry,{subjectName:n||o,caseStudy:t,sections:i,extracts:l,partsCompletionStateMap:Z,userCaseStudy:null!=C?C:c,updateCaseStudyPart:k,caseStudyContentAccess:d,requestId:f})})})};var rA=t(23654),rT=t(2461),rM=t(98401);let rE=e=>{let{caseStudy:r,href:t,onClick:a,accessLevel:l,isAccessible:c,progressPercentage:d,sx:p}=e,h=(0,o.Z)();return(0,s.jsx)(O.Z,{theme:V.rS,children:(0,s.jsxs)(n.Z,{position:"relative",height:"100%",children:[(0,s.jsx)(r_,{caseStudy:r,href:t,onClick:a,progressPercentage:d,sx:p}),c&&r.status===m.kZP.PublishedRestricted?(0,s.jsx)(i.Z,{sx:{top:h.spacing(-1),right:h.spacing(2),position:"absolute"},children:(0,s.jsx)(x.Xn,{})}):(0,s.jsx)(u.dz,{accessLevel:l,isAccessible:c,isAdminOnly:r.status===m.kZP.AdminOnly,containerStyles:{top:h.spacing(-1),right:h.spacing(2),position:"absolute"}})]})})},r_=e=>{let{onClick:r,caseStudy:{name:t,description_short:n,difficulty:c,duration:m},href:h,progressPercentage:g,sx:y}=e,b=(0,o.Z)();return(0,s.jsx)(rA.Z,{sx:{height:"100%",borderRadius:2,transition:"transform 300ms","&:hover":{transform:"translateY(-5px)"},...y},children:(0,s.jsx)(rT.Z,{component:h?d():a.Z,href:h,onClick:()=>{null==r||r()},sx:{height:"100%",fontFamily:b.typography.fontFamily,".MuiCardActionArea-focusHighlight":{backgroundColor:"transparent"},textTransform:"none"},children:(0,s.jsxs)(rM.Z,{component:i.Z,sx:{height:"100%",p:3},children:[(0,s.jsxs)(i.Z,{height:24,direction:c?"row":"row-reverse",justifyContent:"space-between",alignItems:"center",children:[c&&(0,s.jsx)(x.Sv,{value:c}),m&&(0,s.jsxs)(i.Z,{direction:"row",alignItems:"center",spacing:.5,children:[(0,s.jsx)(p.T3,{sx:{width:"16px",height:"16px"},fill:b.colors.common.primary[200]}),m&&(0,s.jsx)(l.Z,{variant:"p-sm-rg",color:b.colors.common.primary[400],children:"".concat(m," mins")})]})]}),(0,s.jsx)(l.Z,{variant:"p-md-semibold",overflow:"hidden",textOverflow:"ellipsis",mt:2.5,sx:{WebkitLineClamp:2,WebkitBoxOrient:"vertical",display:"-webkit-box"},children:t}),(0,s.jsx)(l.Z,{variant:"p-sm-rg",mt:1,overflow:"hidden",textOverflow:"ellipsis",sx:{WebkitLineClamp:7,WebkitBoxOrient:"vertical",display:"-webkit-box",lineHeight:"1.25rem",color:b.colors.common.primary[600]},children:n}),g?(0,s.jsx)(u.gk,{percentage:g,boxProps:{mt:"auto"}}):null]})})})},rG=async(e,r,t)=>{let{data:{userCaseStudyByEachIdV2:s}}=await e.assessment.query({query:ex.ze,variables:{userId:r,caseStudyId:t}});return s},rq=eJ.kg.child({from:"getOrCreateUserCaseStudy"}),rW=async e=>{let r,{api:t,user:s,caseStudyId:o}=e;try{r=await rG(t,s.id,o)}catch(e){try{let{data:e}=await t.assessment.mutate({mutation:ex.X1,variables:{input:{userId:s.id,caseStudyId:o}}});r=null==e?void 0:e.createUserCaseStudyV2}catch(e){rq.error("Failed to create user case study",{error:e})}}return r||null};t(17620),t(47857),t(6596),eJ.kg.child({from:"getCaseStudyServerSideProps"}),eJ.kg.child({from:"getCaseStudyExtractsServerSideProps"});let rF=eJ.kg.child({from:"getGenericCaseStudyPageProps"}),rB=async e=>{let{subject:r,user:t,bootCampSection:s,subjectFullName:o,subjectFullNameShort:n,contentAccess:i,api:a}=e,l=I.Ar.BootCampSection,c=P.VV.BootCampSection;try{let e={id:s.case_study_id,parent_id:s.id},{data:d,headers:{"x-request-id":u}}=await a.caseStudies.getCaseStudyByContextBySubject(r.id,function(e){switch(e){case I.Ar.CaseStudyGroup:return m.yWx.CaseStudyGroup;case I.Ar.MockExamPaper:return m.yWx.MockExamPaper;case I.Ar.PredictionExamPaper:return m.yWx.PredictionExamPaper;case I.Ar.BootCampSection:return m.yWx.BootCampSection;case I.Ar.QuestionbankSubtopic:case I.Ar.QuestionbankTopic:case I.Ar.Quiz:case I.Ar.RevisionLadder:throw Error("accessContextType: ".concat(e," not supported for video solutions"));default:throw Error("".concat(e," not supported"))}}(l),e.parent_id,e.id,!0),p=null,x={};if(t){p=await rW({api:a,user:t,caseStudyId:e.id});let r={withCaseStudyIds:[e.id],withStatuses:[_.mT.Complete]},{data:s}=await a.caseStudyPartState.searchCaseStudyPartState({filter:r});x=ez().chain(s.data).keyBy(e=>e.case_study_part_id).mapValues(e=>e.status).value()}let{id:h,ai_label:g,mark_scheme_label:y,show_rich_text_toolbar:b}=r;return{isError:!1,error:null,data:{subjectFullName:o,subjectFullNameShort:n,subjectId:h,subjectLabels:{ai_label:g,mark_scheme_label:y},showRichTextToolbar:b,caseStudy:ez().omit(d,["extracts","parts","sections"]),extracts:d.extracts,sections:d.sections,partsCompletionStateMap:x,userCaseStudy:p,caseStudyContentAccess:i,subjectGroupSlug:"",contextEntityId:e.parent_id,accessContextType:l,submittedFromContextType:c,requestId:u,grandparentEntityId:"",paperType:m.w7v.CaseStudy}}}catch(e){return rF.error("Failed to get generic case study page props",{error:e}),{isError:!0,data:null,error:e}}}}}]);